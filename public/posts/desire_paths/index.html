<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>Desire paths in code - Ethan Kent&#39;s dev blog</title>

    
    
    <meta name="description" content="Have you noticed those bootleg paths that shortcut between two sidewalks? They&rsquo;re common in parks and on campuses. They&rsquo;re called desire paths. They show where the sidewalk should have been (sometimes the park or school will actually give in and pave them, leading to strange results when seen on a map).
Programming languages have desire paths, too, and I&rsquo;d argue they demonstrate shortcomings in those languages. Indeed, people often claim that a language doesn&rsquo;t need a particular feature, but the desire paths in their code demonstrate otherwise." />
    <meta name="author" content="Ethan Kent" />
    

    <link href="https://unpkg.com/@master/normal.css" rel="stylesheet">
    <script src="https://unpkg.com/@master/style@1.5.0"></script>
    <script src="https://unpkg.com/@master/styles@1.13.0"></script>
    <script src="https://unpkg.com/master-styles-group"></script>
    <script src="https://unpkg.com/themes.js"></script>
    <script>window.themes = window.themes || new window.Themes()</script>

    <style>
        :root {
            --font-sans: "Inter var", ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        }
    </style></head>
<body class="bg:fade-84@dark font:fade-16@dark font:sans">
    <nav class="w:full h:90 fixed bg:fade-84/.95@dark bg:white z:1000">
    <div class="
        h:full
        w:full
        max-w:1200
        mx:auto
        px:32
        d:flex
        align-items:center
    ">
        <div>
            <a href="/" class="mr-3 font:extralight">
              
              Ethan Kent&#39;s dev blog
              
            </a>
        </div>

        <div class="ml:auto">
            
            
            
        </div>
    </div>
</nav>
<div class="d:flex flex:column@<=sm pt:90 px:24 jc:center gap:44 word-break:break-word">
        <div class="max-w:700 w:full box:content-box">
<article class="box:border-box pt:32">
    <header class="mb:32">
        <div class="font:40 font:extrabold">Desire paths in code</div>
        <div class="mt:16 f:fade-60">
            <time>Jul 28, 2020</time>
            </div>
    </header><div class="
    _:where(a):hover{text-decoration-color:fade}
    _:where(a){text-decoration:2;underline;fade-10;_text-decoration-color:fade-70@dark}
    _:where(blockquote){bl:5;solid;fade-76/.1;_bl:5;solid;fade-34/.1@dark}
    _:where(code){font:90%;_v:middle}
    _:where(code:not(.highlight_*,pre_*)){p:2;6;_r:4}
    _:where(del){text-decoration:1;line-through;fade-68;_text-decoration-color:red-64@dark}
    _:where(figcaption){text:14;_p:10;20;0;_width:fit;_mx:auto;_font:fade-56;_font:fade-57@dark}
    _:where(h1){font:40;_font:extrabold}
    _:where(h1,h2,h3)+:where(h1,h2,h3){mt:.5em}
    _:where(h1,h2,h3,h4,h5,h6){mt:2em}
    _:where(h2){mb:1em;_font:32}
    _:where(h3){font:24}
    _:where(h4){font:20}
    _:where(h5){font:16}
    _:where(h6){font:14}
    _:where(li)::marker{font:fade-44;_font:fade-68@dark}
    _:where(li){pl:.375em}
    _:where(mark){text-decoration:1;underline;#fce016;_bg:transparent;_text-decoration-color:rgb(252;224;22/.5)@dark}
    _:where(p,li){font:fade-76;_font:16;_line-height:1.65;_font:fade-34@dark}
    _:where(p,pre,blockquote,figure,ul,ol,table){my:1.125em}
    >:first-child{mt:0!}
    _:where(pre){p:20;_r:8;_overflow:auto}
    _:where(pre,code:not(.highlight_*)){bg:fade-2;_bg:fade-92!@dark}
    _:where(strong,b,a,code:not(.highlight_*),mark,del){font:fade-92;_font:fade-12@dark}
    _:where(table){width:full;_border-spacing:0}
    _:where(td){v:baseline}
    _:where(td,th):first-child{pl:0}
    _:where(td,th):last-child{pr:0}
    _:where(td,th){bb:1;solid;fade-92/.06;_p:6;_b:fade-4/.04@dark}
    _:where(th){font:fade-78;_font:14;_text:left;_font:fade-12@dark}
    _:where(th,p_code,li_code,a,mark){font:semibold;_font:medium@dark}
    _:where(ul){list-style-type:disc}
    _:where(ul,ol,blockquote){pl:1.5em}
    _:where(video,img){max-width:full}
    _:where(a,mark){text-underline-offset:3}
    _:where(hr){h:2;_bg:fade-10;_bg:fade-70@dark;_my:3em}
"><p>Have you noticed those bootleg paths that shortcut between two sidewalks?
They&rsquo;re common in parks and on campuses. They&rsquo;re called <a href="https://en.wikipedia.org/wiki/Desire_path"><em>desire
paths</em></a>. They show where the
sidewalk <em>should have been</em> (sometimes the park or school will actually give
in and pave them, leading to strange results when seen on a
<a href="https://www.google.com/maps/@35.912851,-79.052018,423m/data=!3m1!1e3">map</a>).</p>
<p>Programming languages have desire paths, too, and I&rsquo;d argue they demonstrate
shortcomings in those languages. Indeed, people often claim that a language
doesn&rsquo;t need a particular feature, but the desire paths in their code
demonstrate otherwise. Thus the old saying, &ldquo;Don&rsquo;t listen to what people say;
watch what they do.&rdquo;</p>
<p>I&rsquo;ll give two examples from Ruby and one from JavaScript.</p>
<h2 id="notimplementederror-as-a-desire-path-for-interfaces"><code>NotImplementedError</code> as a desire path for interfaces</h2>
<p>Ruby&rsquo;s <code>NotImplementedError</code> is <em>not</em> a marker for an abstract method on a
base class. It means &ldquo;a feature is not implemented <em>on the current
platform</em>.&rdquo;<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>Hardcore duck-typers will tell you that it&rsquo;s unnecessary to enforce
interfaces and that one of the beauties of Ruby is that you don&rsquo;t have to go
around writing boilerplate to do so.</p>
<p>And yet, numerous Ruby codebase misuse <code>NotImplementedError</code> as a way to
enforce interfaces. Don&rsquo;t listen to what people say; watch what they do.
People want interfaces.</p>
<h2 id="symbols-as-a-desire-path-for-enums">Symbols as a desire path for enums</h2>
<p>Ruby symbols are everywhere in the language. Sometimes they are unbounded.
For example, if we <code>public_send</code> a symbol in the context of dynamic method
dispatch, we might not know the methods on an object until runtime—heck, they
may not even <em>exist</em> until runtime, as they could be built from an impure
source such as a database, timestamp, or random value.</p>
<p>But at other times, symbols are part of a known universe of values. In that
situation, the Ruby way is to write tests to exercise all the variants. But
because symbols sometimes have long names, and because spelling is not every
coder&rsquo;s strong suit, it&rsquo;s easy to typo a symbol&rsquo;s name. Because of Ruby&rsquo;s
groovy, anything-goes attitude, tooling support for typo-d symbols is
difficult or impossible.</p>
<p>And so sometimes ad hoc double-checking occurs. If 14 enum values are
defined, it can be hard to tell whether that 273-line test file (located in
an entirely different part of the project) exercises every variant. So the
<code>case</code> statement&rsquo;s default branch throws an error.</p>
<p>Sometimes, contrivances like this occur:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> Infielders
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Pitcher</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Pitcher&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Catcher</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Catcher&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FirstBaseman</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;FirstBaseman&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">SecondBaseman</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SecondBaseman&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ThirdBaseman</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ThirdBaseman&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Shortstop</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Shortstop
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span></code></pre></div><p>Now we at least have tooling support.</p>
<p>And of course,
<a href="https://api.rubyonrails.org/v5.2.3/classes/ActiveRecord/Enum.html">Rails</a>
implements enums on models.</p>
<h2 id="ternary-abuse-as-a-desire-path-for-conditional-expressions-or-do-expressions">Ternary abuse as a desire path for conditional expressions or <code>do</code> expressions</h2>
<p>In React JSX/TSX, this kind of code crops up:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span>&lt;<span style="color:#f92672">Foo</span>&gt;
</span></span><span style="display:flex;"><span>  {<span style="color:#a6e22e">something</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">?</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">somethingElse</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">17</span> <span style="color:#f92672">?</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">ThreeAnd17Thing</span> <span style="color:#a6e22e">number</span><span style="color:#f92672">=</span>{Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">foo</span> <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">PI</span>)}&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;We got that 3 and 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">ThreeAnd17Thing</span>&gt;
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">:</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;We got that 3 and not 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">:</span> <span style="color:#a6e22e">somethingElse</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">17</span> <span style="color:#f92672">?</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;We got that not 3 and yes 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">:</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">NeitherThreeNor17Thing</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">bar</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">baz</span>(<span style="color:#a6e22e">moo</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">22</span>)}
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">quux</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">xyzzy</span>}
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">corge</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">grault</span>}
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">thud</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">wubble</span>}
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">flob</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">garply</span>}
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;We got that not 3 and not 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">NeitherThreeNor17Thing</span>&gt;
</span></span><span style="display:flex;"><span>  )}
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">Foo</span>&gt;
</span></span></code></pre></div><p>The problem is that we need the code to be an expression inside the
component, and we aren&rsquo;t quite ready to extract a subcomponent,<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> so
we have a hot potato where we have to keep the code as a long expression
without any intermediate statements.</p>
<p>JavaScript lacks the ergonomics common to expression-based languages. For
example, in Clojure, you&rsquo;d do something like this:<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clojure" data-lang="clojure"><span style="display:flex;"><span>(<span style="color:#66d9ef">if </span>(= <span style="color:#ae81ff">3</span> something)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">if </span>(= <span style="color:#ae81ff">17</span> somethingElse)
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">let </span>[fooTimesPi (* foo Math/PI)
</span></span><span style="display:flex;"><span>          number (<span style="color:#a6e22e">Math/floor</span> fooTimesPi)]
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">ThreeAnd17Thing</span>
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">:number</span> number}
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;We got that 3 and 17 situation this time&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;We got that 3 and not 17 situation this time&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">if </span>(= <span style="color:#ae81ff">17</span> somethingElse)
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;We got that not 3 and yes 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">let </span>[bazArg (+ <span style="color:#ae81ff">22</span> moo)
</span></span><span style="display:flex;"><span>          bar (<span style="color:#a6e22e">baz</span> bazArg)
</span></span><span style="display:flex;"><span>          args {<span style="color:#e6db74">:bar</span> bar
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">:quux</span> xyzzy
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">:corge</span> grault
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">:thud</span> wubble
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">:flob</span> garply}]
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">NeitherThreeNor17Thing</span>
</span></span><span style="display:flex;"><span>        args
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;We got that not 3 and not 17 situation this time&#34;</span>))))
</span></span></code></pre></div><p>Note that we can <code>let</code>-bind locals within the expressions, so we can set the
hot potato down, as it were—while the whole form remains an expression.</p>
<p>In JavaScript, by contrast, the keywords <code>if</code> and <code>else</code> introduce statements, not
expressions, and we don&rsquo;t have a way of binding locals in an expression, so
we have to nest function calls and abuse ternaries.</p>
<p>What&rsquo;s missing is <code>do</code> expressions, which is a <a href="https://github.com/tc39/proposal-do-expressions">Stage 1 TC39
proposal</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span>&lt;<span style="color:#f92672">Foo</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">something</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">3</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">somethingElse</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">17</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fooTimesPi</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">foo</span> <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">PI</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">number</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">fooTimesPi</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">ThreeAnd17Thing</span> <span style="color:#a6e22e">number</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">number</span>}&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;We got that 3 and 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">ThreeAnd17Thing</span>&gt;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;We got that 3 and not 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">somethingElse</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">17</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;We got that not 3 and yes 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bazArg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">moo</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">22</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bar</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">baz</span>(<span style="color:#a6e22e">bazArg</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">args</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">bar</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">quux</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">xyzzy</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">corge</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">grault</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">thud</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">wubble</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">flob</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">garply</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">NeitherThreeNor17Thing</span> {<span style="color:#a6e22e">...args</span>}&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;We got that not 3 and not 17 situation this time&#34;</span>
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">NeitherThreeNor17Thing</span>&gt;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">Foo</span>&gt;
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Class: NotImplementedError, <a href="https://ruby-doc.org/core-2.7.1/NotImplementedError.html">https://ruby-doc.org/core-2.7.1/NotImplementedError.html</a> (last visited July 28, 2020) (emphasis added).&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>We should do that to get rid of the nested <code>if</code>s and clean things up. The discussion that follows assumes we&rsquo;re not going to do that.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>There&rsquo;s no React here; I&rsquo;m pretending the components in the JSX code are function calls here. Also, please forgive errors: I don&rsquo;t have a Clojure environment set up to lint/indent this, so I did it by hand.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</div></article>
<footer class="py:24">
    <div class="f:fade-30 f:14 mb:8"></div>
    <div class="f:fade-60 f:12">Theme <a class="f:bold" href="https://github.com/serkodev/holy" _target="_blank">Holy</a></div>
</footer></div>
    </div>
</body>

</html>