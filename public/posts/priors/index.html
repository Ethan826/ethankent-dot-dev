<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>Priors - Ethan Kent&#39;s dev blog</title>

    
    
    <meta name="description" content="There&rsquo;s a lyric in a They Might Be Giants song:1
Now you&rsquo;re the only one here, Who can tell me if it&rsquo;s true: That you love me, And I love me.
The lyric is effective because it uses our expectations of rhyme scheme, parallelism, and reciprocity to have us all but certain that the final line of the verse will end with you. And the surprise serves a purpose: it uses the flouting of our expectations as a way of making us feel the potency of the narrator&rsquo;s self-centeredness." />
    <meta name="author" content="Ethan Kent" />
    

    <link href="https://unpkg.com/@master/normal.css" rel="stylesheet">
    <script src="https://unpkg.com/@master/style@1.5.0"></script>
    <script src="https://unpkg.com/@master/styles@1.13.0"></script>
    <script src="https://unpkg.com/master-styles-group"></script>
    <script src="https://unpkg.com/themes.js"></script>
    <script>window.themes = window.themes || new window.Themes()</script>

    <style>
        :root {
            --font-sans: "Inter var", ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        }
    </style></head>
<body class="bg:fade-84@dark font:fade-16@dark font:sans">
    <nav class="w:full h:90 fixed bg:fade-84/.95@dark bg:white z:1000">
    <div class="
        h:full
        w:full
        max-w:1200
        mx:auto
        px:32
        d:flex
        align-items:center
    ">
        <div>
            <a href="/" class="mr-3 font:extralight">
              
              Ethan Kent&#39;s dev blog
              
            </a>
        </div>

        <div class="ml:auto">
            
            
            
        </div>
    </div>
</nav>
<div class="d:flex flex:column@<=sm pt:90 px:24 jc:center gap:44 word-break:break-word">
        <div class="max-w:700 w:full box:content-box">
<article class="box:border-box pt:32">
    <header class="mb:32">
        <div class="font:40 font:extrabold">Priors</div>
        <div class="mt:16 f:fade-60">
            <time>Dec 2, 2019</time>
            </div>
    </header><div class="
    _:where(a):hover{text-decoration-color:fade}
    _:where(a){text-decoration:2;underline;fade-10;_text-decoration-color:fade-70@dark}
    _:where(blockquote){bl:5;solid;fade-76/.1;_bl:5;solid;fade-34/.1@dark}
    _:where(code){font:90%;_v:middle}
    _:where(code:not(.highlight_*,pre_*)){p:2;6;_r:4}
    _:where(del){text-decoration:1;line-through;fade-68;_text-decoration-color:red-64@dark}
    _:where(figcaption){text:14;_p:10;20;0;_width:fit;_mx:auto;_font:fade-56;_font:fade-57@dark}
    _:where(h1){font:40;_font:extrabold}
    _:where(h1,h2,h3)+:where(h1,h2,h3){mt:.5em}
    _:where(h1,h2,h3,h4,h5,h6){mt:2em}
    _:where(h2){mb:1em;_font:32}
    _:where(h3){font:24}
    _:where(h4){font:20}
    _:where(h5){font:16}
    _:where(h6){font:14}
    _:where(li)::marker{font:fade-44;_font:fade-68@dark}
    _:where(li){pl:.375em}
    _:where(mark){text-decoration:1;underline;#fce016;_bg:transparent;_text-decoration-color:rgb(252;224;22/.5)@dark}
    _:where(p,li){font:fade-76;_font:16;_line-height:1.65;_font:fade-34@dark}
    _:where(p,pre,blockquote,figure,ul,ol,table){my:1.125em}
    >:first-child{mt:0!}
    _:where(pre){p:20;_r:8;_overflow:auto}
    _:where(pre,code:not(.highlight_*)){bg:fade-2;_bg:fade-92!@dark}
    _:where(strong,b,a,code:not(.highlight_*),mark,del){font:fade-92;_font:fade-12@dark}
    _:where(table){width:full;_border-spacing:0}
    _:where(td){v:baseline}
    _:where(td,th):first-child{pl:0}
    _:where(td,th):last-child{pr:0}
    _:where(td,th){bb:1;solid;fade-92/.06;_p:6;_b:fade-4/.04@dark}
    _:where(th){font:fade-78;_font:14;_text:left;_font:fade-12@dark}
    _:where(th,p_code,li_code,a,mark){font:semibold;_font:medium@dark}
    _:where(ul){list-style-type:disc}
    _:where(ul,ol,blockquote){pl:1.5em}
    _:where(video,img){max-width:full}
    _:where(a,mark){text-underline-offset:3}
    _:where(hr){h:2;_bg:fade-10;_bg:fade-70@dark;_my:3em}
"><p>There&rsquo;s a lyric in a They Might Be Giants song:<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<blockquote>
<p>Now you&rsquo;re the only one here,<!-- raw HTML omitted -->
Who can tell me if it&rsquo;s true:<!-- raw HTML omitted -->
That you love me,<!-- raw HTML omitted -->
And I love me.</p>
</blockquote>
<p>The lyric is effective because it uses our expectations of rhyme scheme,
parallelism, and reciprocity to have us all but certain that the final line
of the verse will end with <em>you</em>. And the surprise serves a purpose: it uses
the flouting of our expectations as a way of making us feel the potency of
the narrator&rsquo;s self-centeredness.</p>
<p>The same thing happens when we read code: our expectations are set by
familiar patterns. When something confounds our expectations, we will likely
assume it serves a purpose. Sometimes our priors are so strong that—like an
optical illusion—we see what we expect rather than what is actually there.</p>
<p>In practice, that means that a departure from common patterns may present in
at least two ways:</p>
<ol>
<li>If the difference is something you notice but serves no purpose, you may
become confused, because you assume the difference <em>does</em> serve a purpose.</li>
<li>If the difference is subtle or your prior is strong enough, you may not
notice the difference.</li>
</ol>
<h2 id="departing-from-normal-patterns-for-no-reason-is-confusing">Departing from normal patterns for no reason is confusing.</h2>
<p>Consider this code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_that_thing</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">:thingy_1</span> <span style="color:#66d9ef">if</span> @foo<span style="color:#f92672">.</span>bar <span style="color:#f92672">==</span> <span style="color:#e6db74">:baz</span>
</span></span><span style="display:flex;"><span>  @blip<span style="color:#f92672">.</span>thingy_kind
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>I would expect this code to be written using a very famous thing called an
<code>else</code> statement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_that_thing</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> @foo<span style="color:#f92672">.</span>bar <span style="color:#f92672">==</span> <span style="color:#e6db74">:baz</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">:thingy_1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    @blip<span style="color:#f92672">.</span>thingy_kind
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>or even</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_that_thing</span>
</span></span><span style="display:flex;"><span>  @foo<span style="color:#f92672">.</span>bar <span style="color:#f92672">==</span> <span style="color:#e6db74">:baz</span> ? <span style="color:#e6db74">:thingy_1</span> : @blip<span style="color:#f92672">.</span>thingy_kind
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>I also have the general prior that code should have as few execution paths as
possible, and expect that short-circuit returns will generally be used to
bypass significant amounts of code.</p>
<p>So the first code listing winds up taking some extra time to think through.
&ldquo;Hmm,&rdquo; I think, &ldquo;I wonder why this isn&rsquo;t an <code>if</code>/<code>else</code>. I must be missing
something here. This isn&rsquo;t a short-circuit that avoids a big chunk of code.
Is there something about the conditional that prevents it from working with
an <code>if</code>/<code>else</code>? No. Why is it like this? I guess there&rsquo;s no particular
reason. Weird. Wait, what was I about to do? I better check in on Slack.&rdquo;</p>
<h2 id="doing-something-important-in-a-subtle-unexpected-way-is-dangerous">Doing something important in a subtle, unexpected way is dangerous.</h2>
<p>I have seen this pattern several times:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">foo</span>(my_arg)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (result <span style="color:#f92672">=</span> expensive_computation(my_arg))
</span></span><span style="display:flex;"><span>    @my_orm<span style="color:#f92672">.</span>computed_value <span style="color:#f92672">=</span> result
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">MyLoggingBuddy</span><span style="color:#f92672">.</span>log_nobody_reads(<span style="color:#e6db74">&#34;It has all gone terribly wrong&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>My thinking here is &ldquo;Okay, check to see if <code>result</code> equals
<code>expensive_computation</code>. Wait, where is <code>result</code> defined? Is that a method
call? It can&rsquo;t be a local. Looks like there&rsquo;s a bug here, too: that&rsquo;s a
single equals sign. <em>Oh, wait</em>: is that intentional? Is this assigning the
result of calling <code>expensive_computation</code> to <code>result</code>, and then evaluating
<code>result</code> for truthiness? Ugh—I see <em>why</em> this is happening, and I guess I
vaguely remember that it&rsquo;s an idiom in Ruby to use parentheses in an <code>if</code>
statement if you&rsquo;re doing this, but that is super easy to miss.&rdquo;</p>
<p>My strong prior is that it is an extremely common error to use <code>=</code> instead of
<code>==</code> in a conditional. Another (albeit weaker) prior is that code will
generally separate distinct kinds of operations—avoiding things like
assignment within control flow.<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> Here, things run so strongly against
my priors that I may not even see what&rsquo;s going on: my eyes don&rsquo;t see that
single equals sign the first time around.</p>
<!-- raw HTML omitted -->
<p>If you do something obvious that differs from your reader&rsquo;s priors for no
particular reason, your reader will likely assume it <em>was</em> for good reason
and will waste time trying to figure out what that reason was. Even worse, if
you do something subtle that differs from you reader&rsquo;s priors for an
important reason, your reader may miss what&rsquo;s going on entirely, as we tend
to pay little attention to something familiar.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://youtu.be/gLcp8Dm-ejU?t=67"><em>Kiss Me, Son of God</em></a>, <em>Lincoln</em> (Bar/None Records 1988).&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>That is, unless language constructs exist to do exactly that, as in <code>match</code> and <code>if let</code> statements in some languages.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</div></article>
<footer class="py:24">
    <div class="f:fade-30 f:14 mb:8"></div>
    <div class="f:fade-60 f:12">Theme <a class="f:bold" href="https://github.com/serkodev/holy" _target="_blank">Holy</a></div>
</footer></div>
    </div>
</body>

</html>